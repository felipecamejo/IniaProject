<div class="container">
  <p-card class="card">
    <ng-template pTemplate="header">
      <h2 class="title">Pureza</h2>
    </ng-template>

    <form>

      <div class="form-grid">
        <!-- Fecha -->
        <div class="form-field">
          <label for="fecha">Fecha</label>
          <input id="fecha" type="date" [(ngModel)]="fecha" name="fecha" pInputText />
        </div>

        <!-- Peso inicial -->
        <div class="form-field">
          <label>Peso inicial</label>
          <div class="input-group" style="display: flex; gap: 0.5rem; align-items: center;">
            <div style="flex:1; display: flex; align-items: center;">
              <input type="number" [(ngModel)]="pesoInicialGr" name="pesoInicialGr" pInputText style="width: 100%;" />
              <span style="margin-left: 0.25rem; font-size: 0.9em;">g</span>
            </div>
            <div style="flex:1; display: flex; align-items: center;">
              <input type="number" [(ngModel)]="pesoInicialPct" name="pesoInicialPct" pInputText style="width: 100%;" />
              <span style="margin-left: 0.25rem; font-size: 0.9em;">%</span>
            </div>
          </div>
        </div>

        <!-- Semilla pura -->
        <div class="form-field">
          <label>Semilla pura</label>
          <div class="input-group" style="display: flex; gap: 0.5rem; align-items: center;">
            <div style="flex:1; display: flex; align-items: center;">
              <input type="number" [(ngModel)]="semillaPuraGr" name="semillaPuraGr" pInputText style="width: 100%;" />
              <span style="margin-left: 0.25rem; font-size: 0.9em;">g</span>
            </div>
            <div style="flex:1; display: flex; align-items: center;">
              <input type="number" [(ngModel)]="semillaPuraPct" name="semillaPuraPct" pInputText style="width: 100%;" />
              <span style="margin-left: 0.25rem; font-size: 0.9em;">%</span>
            </div>
          </div>
        </div>

        <!-- Materia inerte -->
        <div class="form-field">
          <label>Materia inerte</label>
          <div class="input-group" style="display: flex; gap: 0.5rem; align-items: center;">
            <div style="flex:1; display: flex; align-items: center;">
              <input type="number" [(ngModel)]="materiaInerteGr" name="materiaInerteGr" pInputText style="width: 100%;" />
              <span style="margin-left: 0.25rem; font-size: 0.9em;">g</span>
            </div>
            <div style="flex:1; display: flex; align-items: center;">
              <input type="number" [(ngModel)]="materiaInertePct" name="materiaInertePct" pInputText style="width: 100%;" />
              <span style="margin-left: 0.25rem; font-size: 0.9em;">%</span>
            </div>
          </div>
        </div>

        <!-- Otros cultivos (g y %) -->
        <div class="form-field">
          <label>Otros cultivos</label>
          <div class="input-group" style="display: flex; gap: 0.5rem; align-items: center;">
            <div style="flex:1; display: flex; align-items: center;">
              <input type="number" [(ngModel)]="otrosCultivosGr" name="otrosCultivosGr" pInputText style="width: 100%;" />
              <span style="margin-left: 0.25rem; font-size: 0.9em;">g</span>
            </div>
            <div style="flex:1; display: flex; align-items: center;">
              <input type="number" [(ngModel)]="otrosCultivosPct" name="otrosCultivosPct" pInputText style="width: 100%;" />
              <span style="margin-left: 0.25rem; font-size: 0.9em;">%</span>
            </div>
          </div>
        </div>

        <!-- Malezas (g y %) -->
        <div class="form-field">
          <label>Malezas</label>
          <div class="input-group" style="display: flex; gap: 0.5rem; align-items: center;">
            <div style="flex:1; display: flex; align-items: center;">
              <input type="number" [(ngModel)]="malezasGr" name="malezasGr" pInputText style="width: 100%;" />
              <span style="margin-left: 0.25rem; font-size: 0.9em;">g</span>
            </div>
            <div style="flex:1; display: flex; align-items: center;">
              <input type="number" [(ngModel)]="malezasPct" name="malezasPct" pInputText style="width: 100%;" />
              <span style="margin-left: 0.25rem; font-size: 0.9em;">%</span>
            </div>
          </div>
        </div>

        <!-- Malezas toleradas (g y %) -->
        <div class="form-field">
          <label>Malezas toleradas</label>
          <div class="input-group" style="display: flex; gap: 0.5rem; align-items: center;">
            <div style="flex:1; display: flex; align-items: center;">
              <input type="number" [(ngModel)]="malezasToleradasGr" name="malezasToleradasGr" pInputText style="width: 100%;" />
              <span style="margin-left: 0.25rem; font-size: 0.9em;">g</span>
            </div>
            <div style="flex:1; display: flex; align-items: center;">
              <input type="number" [(ngModel)]="malezasToleradasPct" name="malezasToleradasPct" pInputText style="width: 100%;" />
              <span style="margin-left: 0.25rem; font-size: 0.9em;">%</span>
            </div>
          </div>
        </div>

        <!-- Peso total (g y %) -->
        <div class="form-field">
          <label>Peso total</label>
          <div class="input-group" style="display: flex; gap: 0.5rem; align-items: center;">
            <div style="flex:1; display: flex; align-items: center;">
              <input type="number" [(ngModel)]="pesoTotalGr" name="pesoTotalGr" pInputText style="width: 100%;" />
              <span style="margin-left: 0.25rem; font-size: 0.9em;">g</span>
            </div>
            <div style="flex:1; display: flex; align-items: center;">
              <input type="number" [(ngModel)]="pesoTotalPct" name="pesoTotalPct" pInputText style="width: 100%;" />
              <span style="margin-left: 0.25rem; font-size: 0.9em;">%</span>
            </div>
          </div>
        </div>

        <!-- Fecha estándar -->
        <div class="form-field">
          <label for="fechaEstandar">Fecha estándar</label>
          <input id="fechaEstandar" type="date" [(ngModel)]="fechaEstandar" name="fechaEstandar" pInputText />
        </div>


        <!-- Multiselect Malezas tolerancia cero -->
        <div class="form-field">
          <label>Malezas tolerancia cero</label>
          <div class="custom-multiselect" [class.open]="isMalezasCeroDropdownOpen">
            <div class="multiselect-trigger" (click)="toggleMalezasCeroDropdown()">
              <span class="selected-text">
                {{ getSelectedMalezasCeroText() }}
              </span>
              <i class="pi pi-chevron-down" [class.rotated]="isMalezasCeroDropdownOpen"></i>
            </div>
            <div class="multiselect-dropdown" *ngIf="isMalezasCeroDropdownOpen">
              <div class="multiselect-search">
                <input type="text" placeholder="Buscar..." [(ngModel)]="malezasCeroSearchText" name="malezasCeroSearch" (click)="$event.stopPropagation()" class="search-input">
                <i class="pi pi-search"></i>
              </div>
              <div class="multiselect-options-container">
                <div class="multiselect-option" *ngFor="let mc of getFilteredMalezasCero()" (click)="toggleMalezaCeroSelection(mc)" [class.selected]="isMalezaCeroSelected(mc.id)">
                  <input type="checkbox" [checked]="isMalezaCeroSelected(mc.id)" (change)="toggleMalezaCeroSelection(mc)" (click)="$event.stopPropagation()">
                  <span>{{ mc.label }}</span>
                </div>
                <div class="no-results" *ngIf="getFilteredMalezasCero().length === 0">No se encontraron opciones</div>
              </div>
            </div>
          </div>
        </div>
        <!-- Multiselect Malezas comunes -->
        <div class="form-field">
          <label>Malezas comunes</label>
          <div class="custom-multiselect" [class.open]="isMalezasComunesDropdownOpen">
            <div class="multiselect-trigger" (click)="toggleMalezasComunesDropdown()">
              <span class="selected-text">
                {{ getSelectedMalezasComunesText() }}
              </span>
              <i class="pi pi-chevron-down" [class.rotated]="isMalezasComunesDropdownOpen"></i>
            </div>
            <div class="multiselect-dropdown" *ngIf="isMalezasComunesDropdownOpen">
              <div class="multiselect-search">
                <input type="text" placeholder="Buscar..." [(ngModel)]="malezasComunesSearchText" name="malezasComunesSearch" (click)="$event.stopPropagation()" class="search-input">
                <i class="pi pi-search"></i>
              </div>
              <div class="multiselect-options-container">
                <div class="multiselect-option" *ngFor="let m of getFilteredMalezasComunes()" (click)="toggleMalezaComunSelection(m)" [class.selected]="isMalezaComunSelected(m.id)">
                  <input type="checkbox" [checked]="isMalezaComunSelected(m.id)" (change)="toggleMalezaComunSelection(m)" (click)="$event.stopPropagation()">
                  <span>{{ m.label }}</span>
                </div>
                <div class="no-results" *ngIf="getFilteredMalezasComunes().length === 0">No se encontraron opciones</div>
              </div>
            </div>
          </div>
        </div>
        <!-- Multiselect Malezas toleradas -->
        <div class="form-field">
          <label>Malezas toleradas</label>
          <div class="custom-multiselect" [class.open]="isMalezasToleradasDropdownOpen">
            <div class="multiselect-trigger" (click)="toggleMalezasToleradasDropdown()">
              <span class="selected-text">
                {{ getSelectedMalezasToleradasText() }}
              </span>
              <i class="pi pi-chevron-down" [class.rotated]="isMalezasToleradasDropdownOpen"></i>
            </div>
            <div class="multiselect-dropdown" *ngIf="isMalezasToleradasDropdownOpen">
              <div class="multiselect-search">
                <input type="text" placeholder="Buscar..." [(ngModel)]="malezasToleradasSearchText" name="malezasToleradasSearch" (click)="$event.stopPropagation()" class="search-input">
                <i class="pi pi-search"></i>
              </div>
              <div class="multiselect-options-container">
                <div class="multiselect-option" *ngFor="let mt of getFilteredMalezasToleradas()" (click)="toggleMalezaToleradaSelection(mt)" [class.selected]="isMalezaToleradaSelected(mt.id)">
                  <input type="checkbox" [checked]="isMalezaToleradaSelected(mt.id)" (change)="toggleMalezaToleradaSelection(mt)" (click)="$event.stopPropagation()">
                  <span>{{ mt.label }}</span>
                </div>
                <div class="no-results" *ngIf="getFilteredMalezasToleradas().length === 0">No se encontraron opciones</div>
              </div>
            </div>
          </div>
        </div>
        <!-- Multiselect Otros cultivos -->
        <div class="form-field">
          <label>Otros cultivos</label>
          <div class="custom-multiselect" [class.open]="isCultivosDropdownOpen">
            <div class="multiselect-trigger" (click)="toggleCultivosDropdown()">
              <span class="selected-text">
                {{ getSelectedCultivosText() }}
              </span>
              <i class="pi pi-chevron-down" [class.rotated]="isCultivosDropdownOpen"></i>
            </div>
            <div class="multiselect-dropdown" *ngIf="isCultivosDropdownOpen">
              <div class="multiselect-search">
                <input type="text" placeholder="Buscar..." [(ngModel)]="cultivosSearchText" name="cultivosSearch" (click)="$event.stopPropagation()" class="search-input">
                <i class="pi pi-search"></i>
              </div>
              <div class="multiselect-options-container">
                <div class="multiselect-option" *ngFor="let c of getFilteredCultivos()" (click)="toggleCultivoSelection(c)" [class.selected]="isCultivoSelected(c.id)">
                  <input type="checkbox" [checked]="isCultivoSelected(c.id)" (change)="toggleCultivoSelection(c)" (click)="$event.stopPropagation()">
                  <span>{{ c.label }}</span>
                </div>
                <div class="no-results" *ngIf="getFilteredCultivos().length === 0">No se encontraron opciones</div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Estándar booleano (al final) -->
      <div class="form-field">
        <label for="estandar">¿Cumple estándar?</label>
        <input id="estandar" type="checkbox" [(ngModel)]="estandar" name="estandar" />
      </div>
      <div class="submit-btn">
        <button
          pButton
          type="submit"
          label="Guardar Pureza"
          class="p-button-success"
        ></button>
      </div>
    </form>
  </p-card>
</div>

