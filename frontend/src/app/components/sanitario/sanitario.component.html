<div class="container">
  <!-- Botón de navegación hacia atrás -->
  <button class="back-button" (click)="onCancel()">
    <i class="pi pi-arrow-left"></i>
  </button>
  
  <p-card class="card">
    <ng-template pTemplate="header">
      <h2 class="title">{{ isViewing ? 'Ver Sanitario' : (isEditing ? 'Editar Sanitario' : 'Crear Sanitario') }}</h2>
    </ng-template>

    <form>
      <div class="form-grid">
        <!-- Campos de texto -->

        <div class="form-field">
          <label for="fechaSiembra">Fecha Siembra</label>
          <input id="fechaSiembra" type="date" [(ngModel)]="fechaSiembra" name="fechaSiembra" pInputText [readonly]="isReadonly" />
        </div>

        <div class="form-field">
          <label for="fecha">Fecha</label>
          <input id="fecha" type="date" [(ngModel)]="fecha" name="fecha" pInputText [readonly]="isReadonly" />
        </div>

        <div class="form-field">
          <label for="ficha">Metodo</label>
          <select id="metodos" [(ngModel)]="selectedMetodo" name="metodo" [disabled]="isReadonly">
            <option value="" >Seleccionar Método</option>
            <option *ngFor="let m of metodos" [value]="m.id">{{ m.label }}</option>
          </select>
        </div>  

        <div class="form-field">
          <label for="temperatura">Temperatura</label>
          <input id="temperatura" type="number" [(ngModel)]="temperatura" name="temperatura" pInputText [readonly]="isReadonly" />
        </div>

        <div class="form-field">
          <label for="horasLuzOscuridad">Horas Luz/Oscuridad</label>
          <input id="horasLuzOscuridad" type="number" [(ngModel)]="horasLuzOscuridad" name="horasLuzOscuridad" pInputText [readonly]="isReadonly" />
        </div>

        <div class="form-field">
          <label for="numeroDias">Numero de Dias</label>
          <input id="numeroDias" type="number" [(ngModel)]="numeroDias" name="numeroDias" pInputText [readonly]="isReadonly" />
        </div>

        <div class="form-field">
          <label for="estados">Estado</label>
          <select id="estados" [(ngModel)]="selectedEstado" name="estado" [disabled]="isReadonly">
            <option value="" >Seleccionar Estado</option>
            <option *ngFor="let e of estados" [value]="e.id">{{ e.label }}</option>
          </select>
        </div>  

        <div class="form-field">
          <label for="observaciones">Observaciones</label>
          <textarea id="observaciones" rows="3" [(ngModel)]="observaciones" name="observaciones" pInputText [readonly]="isReadonly"></textarea>
        </div>

        <div class="form-field">
          <label for="numeroSemillasRepeticion">Numero de Semillas por Repeticion</label>
          <input id="numeroSemillasRepeticion" type="number" [(ngModel)]="numeroSemillasRepeticion" name="numeroSemillasRepeticion" pInputText [readonly]="isReadonly" />
        </div>

        <div class="form-field">
          <label for="hongosSelect">Hongos Patógenos</label>
          <div class="custom-multiselect" [class.open]="isHongosDropdownOpen" [class.disabled]="isReadonly">
            <div class="multiselect-trigger" (click)="!isReadonly && toggleHongosDropdown()">
              <span class="selected-text">
                {{ getSelectedHongosText() }}
              </span>
              <i class="pi pi-chevron-down" [class.rotated]="isHongosDropdownOpen"></i>
            </div>
            <div class="multiselect-dropdown" *ngIf="isHongosDropdownOpen">
              <div class="multiselect-search">
                <input type="text" 
                       placeholder="Buscar hongos..." 
                       [(ngModel)]="hongosSearchText"
                       name="hongosSearch"
                       (click)="$event.stopPropagation()"
                       class="search-input">
                <i class="pi pi-search"></i>
              </div>
              <div class="multiselect-options-container">
                <div class="multiselect-option" 
                     *ngFor="let hongo of getFilteredHongos()" 
                     (click)="toggleHongoSelection(hongo)"
                     [class.selected]="isHongoSelected(hongo.id)">
                  <input type="checkbox" 
                         [checked]="isHongoSelected(hongo.id)"
                         (change)="toggleHongoSelection(hongo)"
                         (click)="$event.stopPropagation()">
                  <span>{{ hongo.label }}</span>
                </div>
                <div class="no-results" *ngIf="getFilteredHongos().length === 0">
                  No se encontraron hongos
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Tabla de hongos seleccionados -->
        <div class="table hongos-table" *ngIf="hongosTable.length > 0">
          <h3>Hongos</h3>
          <p-table [value]="hongosTable" [tableStyle]="{'width': 'auto'}">
            <ng-template pTemplate="header">
              <tr>
                <th style="width: auto;">Tipo Hongo</th>
                <th style="width: 100px;">Repeticion</th>
                <th style="width: 100px;">Valor</th>
                <th style="width: 120px;">% Incidencia</th>
              </tr>
            </ng-template>
            <ng-template pTemplate="body" let-hongo let-i="rowIndex">
              <tr>
                <td>{{ hongo.tipoHongo }}</td>
                <td>
                  <input 
                    type="number" 
                    [(ngModel)]="hongosTable[i].repeticion" 
                    name="repeticion_{{i}}"
                    pInputText 
                    style="width: 80px;"
                    [readonly]="isReadonly"
                  />
                </td>
                <td>
                  <input 
                    type="number" 
                    [(ngModel)]="hongosTable[i].valor" 
                    name="valor_{{i}}"
                    pInputText 
                    style="width: 80px;"
                    [readonly]="isReadonly"
                  />
                </td>
                <td>
                  <input 
                    type="number" 
                    [(ngModel)]="hongosTable[i].incidencia" 
                    name="incidencia_{{i}}"
                    pInputText 
                    style="width: 80px;"
                    min="0" 
                    max="100"
                    [readonly]="isReadonly"
                  />
                </td>
              </tr>
            </ng-template>
          </p-table>
        </div>

        <!-- Hongos Contaminantes Campo -->
        <div class="form-field">
          <label for="hongosCampoSelect">Hongos Contaminantes Campo</label>
          <div class="custom-multiselect" [class.open]="isHongosCampoDropdownOpen" [class.disabled]="isReadonly">
            <div class="multiselect-trigger" (click)="!isReadonly && toggleHongosCampoDropdown()">
              <span class="selected-text">
                {{ getSelectedHongosCampoText() }}
              </span>
              <i class="pi pi-chevron-down" [class.rotated]="isHongosCampoDropdownOpen"></i>
            </div>
            <div class="multiselect-dropdown" *ngIf="isHongosCampoDropdownOpen">
              <div class="multiselect-search">
                <input type="text" 
                       placeholder="Buscar hongos..." 
                       [(ngModel)]="hongosCampoSearchText"
                       name="hongosCampoSearch"
                       (click)="$event.stopPropagation()"
                       class="search-input">
                <i class="pi pi-search"></i>
              </div>
              <div class="multiselect-options-container">
                <div class="multiselect-option" 
                     *ngFor="let hongo of getFilteredHongosCampo()" 
                     (click)="toggleHongoCampoSelection(hongo)"
                     [class.selected]="isHongoCampoSelected(hongo.id)">
                  <input type="checkbox" 
                         [checked]="isHongoCampoSelected(hongo.id)"
                         (change)="toggleHongoCampoSelection(hongo)"
                         (click)="$event.stopPropagation()">
                  <span>{{ hongo.label }}</span>
                </div>
                <div class="no-results" *ngIf="getFilteredHongosCampo().length === 0">
                  No se encontraron hongos
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Tabla de hongos contaminantes campo -->
        <div class="table hongos-campo-table" *ngIf="hongosCampoTable.length > 0">
          <h3>Hongos Contaminantes Campo</h3>
          <p-table [value]="hongosCampoTable" [tableStyle]="{'width': 'auto'}">
            <ng-template pTemplate="header">
              <tr>
                <th style="width: auto;">Tipo Hongo</th>
                <th style="width: 100px;">Repeticion</th>
                <th style="width: 100px;">Valor</th>
                <th style="width: 120px;">% Incidencia</th>
              </tr>
            </ng-template>
            <ng-template pTemplate="body" let-hongo let-i="rowIndex">
              <tr>
                <td>{{ hongo.tipoHongo }}</td>
                <td>
                  <input 
                    type="number" 
                    [(ngModel)]="hongosCampoTable[i].repeticion" 
                    name="repeticionCampo_{{i}}"
                    pInputText 
                    style="width: 80px;"
                    [readonly]="isReadonly"
                  />
                </td>
                <td>
                  <input 
                    type="number" 
                    [(ngModel)]="hongosCampoTable[i].valor" 
                    name="valorCampo_{{i}}"
                    pInputText 
                    style="width: 80px;"
                    [readonly]="isReadonly"
                  />
                </td>
                <td>
                  <input 
                    type="number" 
                    [(ngModel)]="hongosCampoTable[i].incidencia" 
                    name="incidenciaCampo_{{i}}"
                    pInputText 
                    style="width: 80px;"
                    min="0" 
                    max="100"
                    [readonly]="isReadonly"
                  />
                </td>
              </tr>
            </ng-template>
          </p-table>
        </div>

        <!-- Hongos Almacenaje -->
        <div class="form-field">
          <label for="hongosAlmacenajeSelect">Hongos Almacenaje</label>
          <div class="custom-multiselect" [class.open]="isHongosAlmacenajeDropdownOpen" [class.disabled]="isReadonly">
            <div class="multiselect-trigger" (click)="!isReadonly && toggleHongosAlmacenajeDropdown()">
              <span class="selected-text">
                {{ getSelectedHongosAlmacenajeText() }}
              </span>
              <i class="pi pi-chevron-down" [class.rotated]="isHongosAlmacenajeDropdownOpen"></i>
            </div>
            <div class="multiselect-dropdown" *ngIf="isHongosAlmacenajeDropdownOpen">
              <div class="multiselect-search">
                <input type="text" 
                       placeholder="Buscar hongos..." 
                       [(ngModel)]="hongosAlmacenajeSearchText"
                       name="hongosAlmacenajeSearch"
                       (click)="$event.stopPropagation()"
                       class="search-input">
                <i class="pi pi-search"></i>
              </div>
              <div class="multiselect-options-container">
                <div class="multiselect-option" 
                     *ngFor="let hongo of getFilteredHongosAlmacenaje()" 
                     (click)="toggleHongoAlmacenajeSelection(hongo)"
                     [class.selected]="isHongoAlmacenajeSelected(hongo.id)">
                  <input type="checkbox" 
                         [checked]="isHongoAlmacenajeSelected(hongo.id)"
                         (change)="toggleHongoAlmacenajeSelection(hongo)"
                         (click)="$event.stopPropagation()">
                  <span>{{ hongo.label }}</span>
                </div>
                <div class="no-results" *ngIf="getFilteredHongosAlmacenaje().length === 0">
                  No se encontraron hongos
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Tabla de hongos almacenaje -->
        <div class="table hongos-almacenaje-table" *ngIf="hongosAlmacenajeTable.length > 0">
          <h3>Hongos Almacenaje</h3>
          <p-table [value]="hongosAlmacenajeTable" [tableStyle]="{'width': 'auto'}">
            <ng-template pTemplate="header">
              <tr>
                <th style="width: auto;">Tipo Hongo</th>
                <th style="width: 100px;">Repeticion</th>
                <th style="width: 100px;">Valor</th>
                <th style="width: 120px;">% Incidencia</th>
              </tr>
            </ng-template>
            <ng-template pTemplate="body" let-hongo let-i="rowIndex">
              <tr>
                <td>{{ hongo.tipoHongo }}</td>
                <td>
                  <input 
                    type="number" 
                    [(ngModel)]="hongosAlmacenajeTable[i].repeticion" 
                    name="repeticionAlmacenaje_{{i}}"
                    pInputText 
                    style="width: 80px;"
                    [readonly]="isReadonly"
                  />
                </td>
                <td>
                  <input 
                    type="number" 
                    [(ngModel)]="hongosAlmacenajeTable[i].valor" 
                    name="valorAlmacenaje_{{i}}"
                    pInputText 
                    style="width: 80px;"
                    [readonly]="isReadonly"
                  />
                </td>
                <td>
                  <input 
                    type="number" 
                    [(ngModel)]="hongosAlmacenajeTable[i].incidencia" 
                    name="incidenciaAlmacenaje_{{i}}"
                    pInputText 
                    style="width: 80px;"
                    min="0" 
                    max="100"
                    [readonly]="isReadonly"
                  />
                </td>
              </tr>
            </ng-template>
          </p-table>
        </div>

        <!-- Checkboxes - visible al editar y ver -->
        <div class="checkbox-container" *ngIf="isEditing || isViewing">
          <h4 class="checkbox-title">{{ isViewing ? 'Opciones' : 'Opciones De Edición' }}</h4>
          <div class="checkbox-grid">
            <div class="checkbox-item">
              <input 
                type="checkbox" 
                id="repetido-checkbox"
                [(ngModel)]="repetido" 
                name="repetido"
                class="custom-checkbox"
                [disabled]="isReadonly"
              />
              <label for="repetido-checkbox" class="checkbox-label">
                <span class="checkmark"></span>
                <span class="checkbox-text">Repetir</span>
              </label>
            </div>
            
            <div class="checkbox-item">
              <input 
                type="checkbox" 
                id="estandar-checkbox"
                [(ngModel)]="estandar" 
                name="estandar"
                class="custom-checkbox"
                [disabled]="isReadonly"
              />
              <label for="estandar-checkbox" class="checkbox-label">
                <span class="checkmark"></span>
                <span class="checkbox-text">Estándar</span>
              </label>
            </div>
          </div>
        </div>

        <div class="submit-btn">
            <button
            *ngIf="!isViewing"
            pButton
            type="button"
            (click)="onSubmit()"
            [label]="isEditing ? 'Actualizar Sanitario' : 'Crear Sanitario'"
            class="p-button-success"
            ></button>
            
            <button
            pButton
            type="button"
            (click)="onCancel()"
            [label]="isViewing ? 'Volver' : 'Cancelar'"
            class="p-button-secondary"
            style="margin-left: 10px;"
            ></button>
        </div>

      </div>    
    </form>
  </p-card>
</div>