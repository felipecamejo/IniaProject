<div class="container">
  <!-- Botón de navegación hacia atrás -->
  <button class="back-button" (click)="onCancel()">
    <i class="pi pi-arrow-left"></i>
  </button>
  
  <p-card class="card">
    <ng-template pTemplate="header">
      <h2 class="title">{{ isEditing ? 'Editar PMS' : 'Crear PMS' }}</h2>
    </ng-template>

    <form (ngSubmit)="onSubmit()">
      
      <!-- Tabla de repeticiones para PMS -->
      <div class="table-section">
        <h3 class="table-title">Tabla de repeticiones - PMS</h3>
        <div class="table-wrapper">
          <p-table [value]="repeticiones" styleClass="p-datatable-sm">
            <ng-template pTemplate="header">
              <tr>
                <th>Repetición</th>
                <th>Gramos</th>
                <th style="width: 100px;">Acciones</th>
              </tr>
            </ng-template>
            <ng-template pTemplate="body" let-rep let-i="rowIndex">
              <tr>
                <td>{{ rep.numero }}</td>
                <td>
                  <div>
                    <p-inputNumber 
                      [(ngModel)]="rep.gramos" 
                      [name]="'gramos' + i" 
                      mode="decimal" 
                      [minFractionDigits]="4" 
                      [maxFractionDigits]="4"
                      [step]="0.0001"
                      [showButtons]="false"
                      styleClass="w-full">
                    </p-inputNumber>
                    <span>g</span>
                  </div>
                </td>
                <td>
                  <button 
                    pButton 
                    type="button" 
                    icon="pi pi-trash" 
                    class="p-button-danger p-button-sm p-button-text" 
                    (click)="eliminarRepeticion(i)" 
                    [disabled]="repeticiones.length === 1" 
                    title="Eliminar repetición">
                  </button>
                </td>
              </tr>
            </ng-template>
          </p-table>
        </div>
        
        <div class="add-repeticion-container">
          <button pButton type="button" label="Agregar repetición" icon="pi pi-plus" 
                  class="p-button-outlined" (click)="agregarRepeticion()">
          </button>
        </div>
      </div>

      <div class="form-grid">
        <!-- Campos de texto -->
        <div class="form-field">
          <label for="pesoMilSemillas">Peso Mil Semillas</label>
          <input id="pesoMilSemillas" type="number" [(ngModel)]="pesoMilSemillas" name="pesoMilSemillas" pInputText step="0.0001" />
        </div>

        <div class="form-field">
          <label for="pesoPromedioCienSemillas">Peso Promedio Cien Semillas</label>
          <input id="pesoPromedioCienSemillas" type="number" [(ngModel)]="pesoPromedioCienSemillas" name="pesoPromedioCienSemillas" pInputText step="0.0001" />
        </div>

        <div class="form-field">
          <label for="pesoPromedioMilSemillas">Peso Promedio Mil Semillas</label>
          <input id="pesoPromedioMilSemillas" type="number" [(ngModel)]="pesoPromedioMilSemillas" name="pesoPromedioMilSemillas" pInputText step="0.0001" />
        </div>

        <div class="form-field">
          <label for="desvioEstandar">Desvío Estándar</label>
          <input id="desvioEstandar" type="number" [(ngModel)]="desvioEstandar" name="desvioEstandar" pInputText step="0.0001" />
        </div>

        <div class="form-field">
          <label for="coeficienteVariacion">Coeficiente de Variación</label>
          <input id="coeficienteVariacion" type="number" [(ngModel)]="coeficienteVariacion" name="coeficienteVariacion" pInputText step="0.0001" />
        </div>


        <div class="form-field">
          <label for="humedadPorcentual">% Humedad</label>
          <input id="humedadPorcentual" type="number" [(ngModel)]="humedadPorcentual" name="humedadPorcentual" pInputText />
        </div>

        <div class="form-field">
          <label for="fechaMedicion">Fecha Medicion</label>
          <input id="fechaMedicion" type="date" [(ngModel)]="fechaMedicion" name="fechaMedicion" pInputText />
        </div> 

         <div class="form-field">
          <label for="comentarios">Comentarios</label>
          <textarea
            id="comentarios"
            rows="3"
            [(ngModel)]="comentarios"
            name="comentarios"
            pInputText
          ></textarea>
        </div>

        <!-- Checkboxes - solo visible al editar -->
        <div class="checkbox-container" *ngIf="isEditing">
          <h4 class="checkbox-title">Opciones De Edición</h4>
          <div class="checkbox-grid">
            <div class="checkbox-item">
              <input 
                type="checkbox" 
                id="repetido-checkbox"
                [(ngModel)]="repetido" 
                name="repetido"
                class="custom-checkbox"
              />
              <label for="repetido-checkbox" class="checkbox-label">
                <span class="checkmark"></span>
                <span class="checkbox-text">Repetir</span>
              </label>
            </div>
            
            <div class="checkbox-item">
              <input 
                type="checkbox" 
                id="estandar-checkbox"
                [(ngModel)]="estandar" 
                name="estandar"
                class="custom-checkbox"
              />
              <label for="estandar-checkbox" class="checkbox-label">
                <span class="checkmark"></span>
                <span class="checkbox-text">Estándar</span>
              </label>
            </div>
          </div>
        </div>

      </div>

      <div class="submit-btn">
        <button
          pButton
          type="submit"
          [label]="isEditing ? 'Actualizar PMS' : 'Crear PMS'"
          class="p-button-success"
        ></button>
        <button
          pButton
          type="button"
          label="Cancelar"
          class="p-button-secondary"
          (click)="onCancel()"
        ></button>
      </div>
    </form>
  </p-card>
</div>
