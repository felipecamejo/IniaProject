<div class="container">
  <!-- Botón de navegación hacia atrás -->
  <button class="back-button" (click)="onCancel()">
    <i class="pi pi-arrow-left"></i>
  </button>
  
  <p-card class="card">
    <ng-template pTemplate="header">
      <h2 class="title">{{ isViewing ? 'Ver PMS' : (isEditing ? 'Editar PMS' : 'Crear PMS') }}</h2>
    </ng-template>

    <form (ngSubmit)="onSubmit()">
      <div class="table-section">
        <h3 class="table-title">Tabla de repeticiones - PMS</h3>
        <div class="table-wrapper">
          <table class="p-table">
            <thead>
              <tr>
                <th>Repetición</th>
                <th>Gramos</th>
                <th *ngIf="!isViewing">Acciones</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let rep of repeticiones; let i = index">
                <td>{{ rep.numero }}</td>
                <td>
                  <div class="gramos-cell">
                    <input
                      type="number"
                      [(ngModel)]="rep.gramos"
                      [name]="'gramos' + i"
                      step="0.0001"
                      [readonly]="isReadonly"
                    />
                  </div>
                </td>
                <td *ngIf="!isViewing">
                  <button pButton type="button"
                          icon="pi pi-trash"
                          class="p-button-danger p-button-sm"
                          (click)="eliminarRepeticion(i)"
                          [disabled]="repeticiones.length === 1"
                          title="Eliminar">
                  </button>
                </td>
              </tr>
            </tbody>
          </table>

          <button pButton type="button"
                  label="Agregar repetición"
                  class="btn-agregar-rep"
                  (click)="agregarRepeticion()">
          </button>
        </div>
      </div>

      <div class="form-grid">
        <!-- Campos de texto -->
        <div class="form-field">
          <label for="pesoMilSemillas">Peso Mil Semillas</label>
          <input id="pesoMilSemillas" type="number" [(ngModel)]="pesoMilSemillas" name="pesoMilSemillas" pInputText step="0.0001" [readonly]="isReadonly" />
        </div>

        <div class="form-field">
          <label for="pesoPromedioCienSemillas">Peso Promedio Cien Semillas</label>
          <input id="pesoPromedioCienSemillas" type="number" [(ngModel)]="pesoPromedioCienSemillas" name="pesoPromedioCienSemillas" pInputText step="0.0001" [readonly]="isReadonly" />
        </div>

        <div class="form-field">
          <label for="pesoPromedioMilSemillas">Peso Promedio Mil Semillas</label>
          <input id="pesoPromedioMilSemillas" type="number" [(ngModel)]="pesoPromedioMilSemillas" name="pesoPromedioMilSemillas" pInputText step="0.0001" [readonly]="isReadonly" />
        </div>

        <div class="form-field">
          <label for="desvioEstandar">Desvío Estándar</label>
          <input id="desvioEstandar" type="number" [(ngModel)]="desvioEstandar" name="desvioEstandar" pInputText step="0.0001" [readonly]="isReadonly" />
        </div>

        <div class="form-field">
          <label for="coeficienteVariacion">Coeficiente de Variación</label>
          <input id="coeficienteVariacion" type="number" [(ngModel)]="coeficienteVariacion" name="coeficienteVariacion" pInputText step="0.0001" [readonly]="isReadonly" />
        </div>


        <div class="form-field">
          <label for="humedadPorcentual">% Humedad</label>
          <input id="humedadPorcentual" type="number" [(ngModel)]="humedadPorcentual" name="humedadPorcentual" pInputText [readonly]="isReadonly" />
        </div>

        <div class="form-field">
          <label for="fechaMedicion">Fecha Medicion</label>
          <input id="fechaMedicion" type="date" [(ngModel)]="fechaMedicion" name="fechaMedicion" pInputText [readonly]="isReadonly" />
        </div> 

         <div class="form-field">
          <label for="comentarios">Comentarios</label>
          <textarea
            id="comentarios"
            rows="3"
            [(ngModel)]="comentarios"
            name="comentarios"
            pInputText
            [readonly]="isReadonly"
          ></textarea>
        </div>

        <!-- Checkboxes - visible al editar y ver -->
        <div class="checkbox-container" *ngIf="isEditing || isViewing">
          <h4 class="checkbox-title">{{ isViewing ? 'Opciones' : 'Opciones De Edición' }}</h4>
          <div class="checkbox-grid">
            <div class="checkbox-item">
              <input 
                type="checkbox" 
                id="repetido-checkbox"
                [(ngModel)]="repetido" 
                name="repetido"
                class="custom-checkbox"
                [disabled]="isReadonly"
              />
              <label for="repetido-checkbox" class="checkbox-label">
                <span class="checkmark"></span>
                <span class="checkbox-text">Repetir</span>
              </label>
            </div>
            
            <div class="checkbox-item">
              <input 
                type="checkbox" 
                id="estandar-checkbox"
                [(ngModel)]="estandar" 
                name="estandar"
                class="custom-checkbox"
                [disabled]="isReadonly"
              />
              <label for="estandar-checkbox" class="checkbox-label">
                <span class="checkmark"></span>
                <span class="checkbox-text">Estándar</span>
              </label>
            </div>
          </div>
        </div>

      </div>

      <div class="submit-btn">
        <button
          *ngIf="!isViewing"
          pButton
          type="submit"
          [label]="isEditing ? 'Actualizar PMS' : 'Crear PMS'"
          class="p-button-success"
        ></button>
        <button
          pButton
          type="button"
          [label]="isViewing ? 'Volver' : 'Cancelar'"
          class="p-button-secondary"
          (click)="onCancel()"
        ></button>
      </div>
    </form>
  </p-card>
</div>
