<div class="container">
  <p-card class="card">
    <ng-template pTemplate="header">
  <h2 class="title">{{ isEditing ? 'Editar Tetrazolio' : 'Crear Tetrazolio' }}</h2>
    </ng-template>
    <form>
      <!-- Tabla de repeticiones para Tetrazolio -->
      <h3 style="margin-top:2rem;">Tabla de repeticiones - Tetrazolio</h3>
      <div class="table-wrapper">
        <table class="p-table tetrazolio-table">
          <thead>
            <tr>
              <th>Repeticion</th>
              <th>Viables</th>
              <th>No viables</th>
              <th>Duras</th>
              <th></th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let rep of repeticiones; let i = index">
              <td>{{ rep.numero }}</td>
              <td><input type="number" [(ngModel)]="rep.viables" name="viables{{i}}" /></td>
              <td><input type="number" [(ngModel)]="rep.noViables" name="noViables{{i}}" /></td>
              <td><input type="number" [(ngModel)]="rep.duras" name="duras{{i}}" /></td>
              <td>
                <button pButton type="button" icon="pi pi-trash" class="p-button-danger p-button-sm" (click)="eliminarRepeticion(i)" [disabled]="repeticiones.length === 1" title="Eliminar"></button>
              </td>
            </tr>
          </tbody>
          <tfoot>
            <tr>
              <td class="footer-label">Total</td>
              <td><input type="number" [value]="getTotalViables()" readonly /></td>
              <td><input type="number" [value]="getTotalNoViables()" readonly /></td>
              <td><input type="number" [value]="getTotalDuras()" readonly /></td>
              <td></td>
            </tr>
            <tr>
              <td class="footer-label">Prom. redondeado</td>
              <td><input type="number" [value]="getPromedioViables(true)" readonly /></td>
              <td><input type="number" [value]="getPromedioNoViables(true)" readonly /></td>
              <td><input type="number" [value]="getPromedioDuras(true)" readonly /></td>
              <td></td>
            </tr>
            <tr>
              <td class="footer-label">Prom. sin redondeo</td>
              <td><input type="number" [value]="getPromedioViables(false)" readonly /></td>
              <td><input type="number" [value]="getPromedioNoViables(false)" readonly /></td>
              <td><input type="number" [value]="getPromedioDuras(false)" readonly /></td>
              <td></td>
            </tr>
          </tfoot>
        </table>
        <button pButton type="button" label="Agregar repetición" class="btn-agregar-rep" (click)="agregarRepeticion()"></button>
      </div>







      <!-- Nueva tabla de detalles de semillas -->
      <h3 style="margin-top:2.5rem;">Detalle de semillas y daños</h3>
      <div class="table-wrapper">
        <table class="p-table tetrazolio-table">
          <thead>
            <tr>
              <th></th>
              <th>N° de semillas</th>
              <th>Daño mecánico</th>
              <th>Daño ambiente</th>
              <th>Daño chinches</th>
              <th>Daño fracturas</th>
              <th>Otros daños</th>
              <th>Duras</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="footer-label">Viables sin defectos</td>
              <td><input type="number" [(ngModel)]="detalle.viablesSinDefectos.total" name="vsd_total" /></td>
              <td><input type="number" [(ngModel)]="detalle.viablesSinDefectos.mecanico" name="vsd_mecanico" /></td>
              <td><input type="number" [(ngModel)]="detalle.viablesSinDefectos.ambiente" name="vsd_ambiente" /></td>
              <td><input type="number" [(ngModel)]="detalle.viablesSinDefectos.chinches" name="vsd_chinches" /></td>
              <td><input type="number" [(ngModel)]="detalle.viablesSinDefectos.fracturas" name="vsd_fracturas" /></td>
              <td><input type="number" [(ngModel)]="detalle.viablesSinDefectos.otros" name="vsd_otros" /></td>
              <td><input type="number" [(ngModel)]="detalle.viablesSinDefectos.duras" name="vsd_duras" /></td>
            </tr>
            <tr>
              <td class="footer-label">Viables defectos leves</td>
              <td><input type="number" [(ngModel)]="detalle.viablesLeves.total" name="vl_total" /></td>
              <td><input type="number" [(ngModel)]="detalle.viablesLeves.mecanico" name="vl_mecanico" /></td>
              <td><input type="number" [(ngModel)]="detalle.viablesLeves.ambiente" name="vl_ambiente" /></td>
              <td><input type="number" [(ngModel)]="detalle.viablesLeves.chinches" name="vl_chinches" /></td>
              <td><input type="number" [(ngModel)]="detalle.viablesLeves.fracturas" name="vl_fracturas" /></td>
              <td><input type="number" [(ngModel)]="detalle.viablesLeves.otros" name="vl_otros" /></td>
              <td><input type="number" [(ngModel)]="detalle.viablesLeves.duras" name="vl_duras" /></td>
            </tr>
            <tr>
              <td class="footer-label">Viables defectos moderados</td>
              <td><input type="number" [(ngModel)]="detalle.viablesModerados.total" name="vm_total" /></td>
              <td><input type="number" [(ngModel)]="detalle.viablesModerados.mecanico" name="vm_mecanico" /></td>
              <td><input type="number" [(ngModel)]="detalle.viablesModerados.ambiente" name="vm_ambiente" /></td>
              <td><input type="number" [(ngModel)]="detalle.viablesModerados.chinches" name="vm_chinches" /></td>
              <td><input type="number" [(ngModel)]="detalle.viablesModerados.fracturas" name="vm_fracturas" /></td>
              <td><input type="number" [(ngModel)]="detalle.viablesModerados.otros" name="vm_otros" /></td>
              <td><input type="number" [(ngModel)]="detalle.viablesModerados.duras" name="vm_duras" /></td>
            </tr>
            <tr>
              <td class="footer-label">Viables defectos severos</td>
              <td><input type="number" [(ngModel)]="detalle.viablesSeveros.total" name="vs_total" /></td>
              <td><input type="number" [(ngModel)]="detalle.viablesSeveros.mecanico" name="vs_mecanico" /></td>
              <td><input type="number" [(ngModel)]="detalle.viablesSeveros.ambiente" name="vs_ambiente" /></td>
              <td><input type="number" [(ngModel)]="detalle.viablesSeveros.chinches" name="vs_chinches" /></td>
              <td><input type="number" [(ngModel)]="detalle.viablesSeveros.fracturas" name="vs_fracturas" /></td>
              <td><input type="number" [(ngModel)]="detalle.viablesSeveros.otros" name="vs_otros" /></td>
              <td><input type="number" [(ngModel)]="detalle.viablesSeveros.duras" name="vs_duras" /></td>
            </tr>
            <tr>
              <td class="footer-label">No viables</td>
              <td><input type="number" [(ngModel)]="detalle.noViables.total" name="nv_total" /></td>
              <td><input type="number" [(ngModel)]="detalle.noViables.mecanico" name="nv_mecanico" /></td>
              <td><input type="number" [(ngModel)]="detalle.noViables.ambiente" name="nv_ambiente" /></td>
              <td><input type="number" [(ngModel)]="detalle.noViables.chinches" name="nv_chinches" /></td>
              <td><input type="number" [(ngModel)]="detalle.noViables.fracturas" name="nv_fracturas" /></td>
              <td><input type="number" [(ngModel)]="detalle.noViables.otros" name="nv_otros" /></td>
              <td><input type="number" [(ngModel)]="detalle.noViables.duras" name="nv_duras" /></td>
            </tr>
            <tr>
              <td class="footer-label">Semillas viables</td>
              <td><input type="number" [value]="getSemillasViablesTotal()" readonly /></td>
              <td><input type="number" [value]="getSemillasViables('mecanico')" readonly /></td>
              <td><input type="number" [value]="getSemillasViables('ambiente')" readonly /></td>
              <td><input type="number" [value]="getSemillasViables('chinches')" readonly /></td>
              <td><input type="number" [value]="getSemillasViables('fracturas')" readonly /></td>
              <td><input type="number" [value]="getSemillasViables('otros')" readonly /></td>
              <td><input type="number" [value]="getSemillasViables('duras')" readonly /></td>
            </tr>
            <tr>
              <td class="footer-label">Suma</td>
              <td><input type="number" [value]="getSumaTotal()" readonly /></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Checkbox Repetido - solo visible al editar -->
      <div class="form-field" *ngIf="isEditing">
        <label>
          <span>Repetir</span>
          <input 
            type="checkbox" 
            [(ngModel)]="repetido" 
            name="repetido"
          />
        </label>
      </div>

      <div class="submit-btn" style="margin-top: 1.2rem;">
        <button
          pButton
          type="button"
          (click)="onSubmit()"
          [label]="isEditing ? 'Actualizar Tetrazolio' : 'Crear Tetrazolio'"
          class="p-button-success"
        ></button>
        
        <button
          pButton
          type="button"
          (click)="onCancel()"
          label="Cancelar"
          class="p-button-secondary"
          style="margin-left: 10px;"
        ></button>
      </div>

    </form>
  </p-card>
</div>


