# Configuración para tests de integración con Testcontainers
# Este archivo se usa cuando @ActiveProfiles("test") está activo

spring.application.name=Proyecto INIA Test

# Habilitar sobrescritura de beans en tests (permite que TestSecurityConfig sobrescriba WebSecurityConfig)
spring.main.allow-bean-definition-overriding=true

# La URL de la base de datos se configura dinámicamente por Testcontainers
# No es necesario especificarla aquí, TestcontainersConfig lo hace automáticamente
# IMPORTANTE: No definir spring.datasource.url, username, password aquí
# Testcontainers lo hace dinámicamente a través de @DynamicPropertySource
# Esto evita que Spring intente conectarse antes de que el contenedor esté listo

# Deshabilitar inicialización automática de DataSource hasta que Testcontainers esté listo
spring.datasource.initialize=false
spring.jpa.defer-datasource-initialization=false

# IMPORTANTE: Las propiedades spring.datasource.url, username, password 
# se configuran dinámicamente por Testcontainers a través de @DynamicPropertySource
# NO definir estas propiedades aquí - Testcontainers las configura automáticamente
# cuando el contenedor se inicia (en el bloque static de TestcontainersConfig)

# Configuración del pool de conexiones para tests (HikariCP)
spring.datasource.hikari.maximum-pool-size=5
spring.datasource.hikari.minimum-idle=2
spring.datasource.hikari.connection-timeout=30000
spring.datasource.hikari.idle-timeout=600000
spring.datasource.hikari.max-lifetime=1800000
spring.datasource.hikari.leak-detection-threshold=60000
spring.datasource.hikari.connection-test-query=SELECT 1

# Configuración JPA para tests
spring.jpa.hibernate.ddl-auto=create-drop
spring.jpa.show-sql=true
spring.jpa.database-platform=org.hibernate.dialect.PostgreSQLDialect
spring.jpa.properties.hibernate.format_sql=true

# Deshabilitar validación de esquema en tests
spring.jpa.properties.hibernate.hbm2ddl.auto=create-drop

# Configuración de logging para tests
logging.level.org.hibernate.SQL=DEBUG
logging.level.org.hibernate.type.descriptor.sql.BasicBinder=TRACE
logging.level.org.testcontainers=INFO
logging.level.com.github.dockerjava=WARN
logging.level.org.rnorth.ducttape=WARN

# Configuración de transacciones para tests
spring.transaction.default-timeout=30
spring.jpa.properties.hibernate.connection.provider_disables_autocommit=false

# Configuración JWT para tests (valores de prueba)
jwt.secret=test_secret_key_for_testing_only_not_for_production_use
jwt.expiration=86400000

# URL del middleware para tests (puede ser mock)
python.middleware.base-url=http://localhost:9099

# Deshabilitar seguridad en algunos tests si es necesario
# spring.security.enabled=false

